<h3 id="accessing-application-log-data">Accessing Application Log Data</h3><h4 id="overview">Overview</h4><p>This document is intended to assist engineers in accessing application and system logs stored in a centralized Elasticsearch cluster.</p>
<h4 id="accessing-kibana">Accessing Kibana</h4><p>The Cloud Platform collects, indexes and presents your application and system log data enabling you to query using Kibanaâ€™s standard query language (based on Lucene query syntax).</p>
<p>To access Kibana, follow the appropriate link below and authenticate with your GitHub credentials:</p>
<h5 id="live-1-cluster">Live-1 Cluster</h5><p><a href="https://kibana.cloud-platform.service.justice.gov.uk/_plugin/kibana">https://kibana.cloud-platform.service.justice.gov.uk/_plugin/kibana</a></p>
<h4 id="using-kibana">Using Kibana</h4><p>As a quick example, we will filter down to the logs of a particular environment.</p>
<p>1) On the Kibana dashboard, select the &lsquo;Discover&rsquo; tab.</p>
<p>2) Select &#39;Add a filter +&rsquo;</p>
<p>3) Filter <code>kubernetes.namespace_name</code>, with operator <code>is</code> and the value equal to your environment name.</p>
<p>The log entries will contain any data output (STDOUT/STDERR) by the running pods.</p>
<h4 id="accessing-ingress-logs">Accessing Ingress logs</h4><p>A special case is the Nginx Ingress which serves as reverse proxy for all the other applications in the cluster. Its logs originate in the <code>ingress-controllers</code> namespace and are indexed separately. To search:</p>
<p>1) Same Kibana &#39;Discover&rsquo; tab, change the index pattern to &#39;index-json*&rsquo; in the drop-down on the left</p>
<p>2) Filter using the prefix <code>nginx-ingress</code>, the full list of indexed fields is defined in <a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/fa2b9f37edc8239ade9d5e02f0c8e4953a9ae21e/terraform/cloud-platform-components/nginx-ingress-acme.tf#L51">terraform</a></p>
<h4 id="accessing-namespace-events">Accessing namespace events</h4><p>Messages generated by events not part of the applications themselves (deployment misconfiguration, pods failing on startup due to lack of resources, actions forbidden by security restrictions) are trapped by a shared <code>Eventrouter</code> which annotates and stores them in the <code>logging</code> namespace. To debug such events:</p>
<p>1) Same Kibana &#39;Discover&rsquo; tab, index pattern &#39;logstash*&rsquo;</p>
<p>2) Search for <code>kubernetes.namespace_name:&quot;logging&quot; AND kubernetes.labels.app:&quot;eventrouter&quot;</code></p>
<p>3) Filter by additional strings in the <code>log</code> field</p>
<p>More in-depth guides on using Kibana can be found below:</p>
<p><a href="https://www.elastic.co/guide/en/kibana/6.3/search.html">https://www.elastic.co/guide/en/kibana/6.3/search.html</a></p>
<p><a href="https://www.elastic.co/guide/en/beats/packetbeat/current/kibana-queries-filters.html">https://www.elastic.co/guide/en/beats/packetbeat/current/kibana-queries-filters.html</a></p>
