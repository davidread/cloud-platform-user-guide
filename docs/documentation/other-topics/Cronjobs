<h3 id="kubernetes-cronjobs">Kubernetes Cronjobs</h3><h4 id="overview">Overview</h4><p>Kubernetes has the concept of <a href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/">Cronjobs</a> which creates Jobs on a time-based schedule, you can use CronJobs to run tasks at a specific time or interval. CronJobs are a good choice for automatic tasks, such as backups, reporting, sending emails, or cleanup tasks.</p>
<h4 id="usage">Usage</h4><p>CronJobs use <a href="https://kubernetes.io/docs/concepts/workloads/controllers/jobs-run-to-completion/">Job</a> objects to complete their tasks. A CronJob creates a Job object each time it runs. CronJobs are created, managed, scaled, and deleted in the same way as Jobs. Cron jobs require a config file, follow the <a href="https://kubernetes.io/docs/tasks/job/automated-tasks-with-cron-jobs/#creating-a-cron-job">guide</a> on creating a Cronjob.</p>
<p>This example cron job below prints the current time and a hello message every first minute of every hour from 0200 to 1400 UTC on Sunday, Monday, Friday, and Saturday</p>
<p>example:</p>
<div class="highlight"><pre class="highlight plaintext"><code>apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: hello
spec:
  schedule: "1 2-14 * * 0-1,5-6"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: hello
            image: busybox
            args:
            - /bin/sh
            - -c
            - date; echo "Hello, World!"
          restartPolicy: OnFailure
</code></pre></div><h4 id="applying-cronjob-in-your-namespace">Applying Cronjob in your Namespace</h4><p>You need a yaml file to define your cronjob. You can either create your own, or use <a href="https://github.com/ministryofjustice/cloud-platform-multi-container-demo-app/tree/cronjob-example-v1.0/k8s_additional_resources">this one</a> as an example. This runs a job periodically on a given schedule to delete untagged images in the ecr-repo, this will help to limit the count of Images in the ecr-repo.</p>
<div class="highlight"><pre class="highlight plaintext"><code>  ```
  kubectl apply --filename cronjob-ecr.yaml --namespace [your namespace]
  ```
</code></pre></div><p>Verify the Cronjob is created, and job is triggered on a given schedule.</p>
<div class="highlight"><pre class="highlight plaintext"><code>  ```
  kubectl get cronjob --namespace [your namespace]
  ```
</code></pre></div><p>Note:
Kubernetes uses UTC exclusively. Make sure you take that into account when youâ€™re creating your schedule.</p>
