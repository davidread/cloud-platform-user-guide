<h3 id="creating-alerts-for-rds">Creating alerts for RDS</h3><h4 id="overview">Overview</h4><p>Alertmanager allows you define your own alert conditions based on <a href="https://prometheus.io/docs/prometheus/latest/querying/basics">Prometheus expression language</a> expressions.</p>
<p>The aim of this document is cover the specifics of alerting for RDS</p>
<h4 id="prerequisites">Prerequisites</h4><p>This guide assumes the following:</p>

<ul>
<li>You have created a namespace for your application</li>
<li>You have an RDS instance defined in that namespace</li>
<li>You are already familiar with creating custom alerts explained <a href="https://user-guide.cloud-platform.service.justice.gov.uk/tasks.html#creating-your-own-custom-alerts">here</a></li>
<li>You know the RDS database identifier you want to monitor. It can be found in the RDS kubernetes secret in your namespace.</li>
</ul>
<h4 id="rds-metrics">RDS metrics</h4><p>Prometheus gathers and exposes a few RDS metrics. Here is the full lists :</p>
<div class="highlight"><pre class="highlight plaintext"><code>aws_rds_cpuutilization_average
aws_rds_database_connections_average
aws_rds_free_storage_space_average
aws_rds_free_storage_space_minimum
aws_rds_free_storage_space_maximum
aws_rds_freeable_memory_average
aws_rds_read_iops_average
aws_rds_read_latency_average
aws_rds_write_iops_average
aws_rds_write_latency_average
</code></pre></div><h4 id="an-example">An example</h4><p>Below a an example of a PrometheusRule, that triggers an alert if the amount of free space of an RDS instance drops below 1Gb.</p>
<div class="highlight"><pre class="highlight yaml"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">monitoring.coreos.com/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PrometheusRule</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">&lt;namespace&gt;</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">role</span><span class="pi">:</span> <span class="s">alert-rules</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">prometheus-custom-rules-&lt;application_name&gt;</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">groups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">application-rules</span>
    <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">RDSLowStorage</span>
        <span class="s">expr</span><span class="pi">:</span> <span class="s">aws_rds_free_storage_space_average{dbinstance_identifier="&lt;YOUR_DB_ID"} offset 10m &lt; 1000000000</span>
        <span class="s">for</span><span class="pi">:</span> <span class="s">5m</span>
        <span class="s">labels</span><span class="pi">:</span>
          <span class="na">severity</span><span class="pi">:</span> <span class="s">&lt;SEVERITY&gt;</span>
        <span class="na">annotations</span><span class="pi">:</span>
          <span class="na">message</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[{{</span><span class="nv"> </span><span class="s">environment|upper</span><span class="nv"> </span><span class="s">}}]</span><span class="nv"> </span><span class="s">RDS</span><span class="nv"> </span><span class="s">free</span><span class="nv"> </span><span class="s">storage</span><span class="nv"> </span><span class="s">space</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">less</span><span class="nv"> </span><span class="s">than</span><span class="nv"> </span><span class="s">1GB"</span>
</code></pre></div>
<ul>
<li>Run <code>kubectl apply -f prometheus-custom-rules-&lt;application_name&gt;.yaml -n &lt;namespace&gt;</code></li>
</ul>
