<h2 id="creating-a-route-53-hosted-zone">Creating a Route 53 Hosted Zone</h2><h3 id="overview">Overview</h3><p>This short guide will run through the process of creating a <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/AboutHZWorkingWith.html">Route 53 Hosted Zone</a> through Terraform for your environment.</p>
<h3 id="pre-requisites">Pre-Requisites</h3><p>This guide assumes you have an environment already created in the <code>Live-1</code> cluster and defined in the <a href="https://github.com/ministryofjustice/cloud-platform-environments">cloud-platform-environments repository</a>.</p>
<h3 id="terraform-files">Terraform files</h3><p>Copy the Terraform resource code below and save it into the respective 2 files in the <code>[your namespace]/resources</code> directory in the <a href="https://github.com/ministryofjustice/cloud-platform-environments">cloud-platform-environments repository</a>:</p>

<ul>
<li><code>main.tf</code></li>
<li><code>variables.tf</code></li>
</ul>
<h4 id="main-tf">main.tf</h4><div class="highlight"><pre class="highlight plaintext"><code>resource "aws_route53_zone" "example_team_route53_zone" {
  name = "${var.domain}"

  tags {
    business-unit          = "${var.business-unit}"
    application            = "${var.application}"
    is-production          = "${var.is-production}"
    environment-name       = "${var.environment-name}"
    owner                  = "${var.team_name}"
    infrastructure-support = "${var.infrastructure-support}"
  }
}

resource "kubernetes_secret" "example_route53_zone_sec" {
  metadata {
    name      = "example-route53-zone-output"
    namespace = "${var.namespace}"
  }

  data {
    zone_id   = "${aws_route53_zone.example_team_route53_zone.zone_id}"
  }
}

</code></pre></div><h4 id="variables-tf">variables.tf</h4><div class="highlight"><pre class="highlight plaintext"><code>variable "domain" {
  description = "The domain you intend to create. This should be a part of either parent zone of *.service.gov.uk or *.service.justice.gov.uk"
}

variable "application" {}

variable "business-unit" {
  description = "Area of the MOJ responsible for the service."
  default     = "mojdigital"
}

variable "team_name" {
  description = "The name of your development team"
}

variable "environment-name" {
  description = "The type of environment you're deploying to."
}

variable "infrastructure-support" {
  description = "The team responsible for managing the infrastructure. Should be of the form team-email."
}

variable "is-production" {
  default = "false"
}
</code></pre></div><h3 id="creating-the-resource">Creating the resource</h3><p>Make sure to change placeholder values to what is appropriate, with the 2 files saved, commit your changes to a branch and raise a pull request. Once approved, you can merge and the changes will be applied. Shortly after, you should be able to access the <code>Zone_ID</code> as Secret on kubernetes in your namespace.</p>
<p>Please contact the Cloud Platform team via the <code>#ask-cloud-platform</code> Slack channel. Provide them with the zone_ID, and they will verify that your hosted zone has been created successfully.</p>
