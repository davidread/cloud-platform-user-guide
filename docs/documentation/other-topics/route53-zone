<h2 id="creating-a-route-53-hosted-zone">Creating a Route 53 Hosted Zone</h2><h3 id="overview">Overview</h3><p>This short guide will run through the process of creating a <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/AboutHZWorkingWith.html">Route 53 Hosted Zone</a> through Terraform for your environment.</p>
<h3 id="pre-requisites">Pre-Requisites</h3><p>This guide assumes you have an environment already created in the <code>Live-1</code> cluster and defined in the <a href="https://github.com/ministryofjustice/cloud-platform-environments">cloud-platform-environments repository</a>.</p>
<h3 id="terraform-files">Terraform files</h3><p>Copy the Terraform resource code below and save it into the respective 2 files in the <code>[your namespace]/resources</code> directory in the <a href="https://github.com/ministryofjustice/cloud-platform-environments">cloud-platform-environments repository</a>:</p>

<ul>
<li><code>main.tf</code></li>
<li><code>route53.tf</code></li>
</ul>
<h4 id="main-tf">main.tf</h4><div class="highlight"><pre class="highlight plaintext"><code>terraform {
  backend "s3" {}
}

provider "aws" {
  region = "eu-west-2"
}
</code></pre></div><p>Note: If you already have that file defined in your environment, do not recreate it.</p>
<h4 id="route53-tf">route53.tf</h4><p>Fill in the <em>name</em> and the <em>namespace</em> fields below, with your domain name &amp; and your existing kubernetes namespace.</p>
<div class="highlight"><pre class="highlight plaintext"><code>resource "aws_route53_zone" "example_team_route53_zone" {
  name = "YOUR DOMAIN GOES HERE"

  tags {
    business-unit          = "example-bu"
    application            = "example-app"
    is-production          = "false"
    environment-name       = "dev"
    owner                  = "example-owner"
    infrastructure-support = "example@example.com"
  }
}

resource "kubernetes_secret" "example_route53_zone_sec" {
  metadata {
    name      = "example-route53-zone-output"
    namespace = "YOUR KUBERNETES NAMESPACE GOES HERE"
  }

  data {
    zone_id   = "${aws_route53_zone.example_team_route53_zone.zone_id}"
  }
}

</code></pre></div><h3 id="creating-the-resource">Creating the resource</h3><p>Make sure to replace the placeholders and example values above with relevant ones, commit your changes to a branch and raise a pull request.<br>
Once approved, you can merge and the changes will be applied.<br>
Shortly after, to confirm the zone has been created, you should be able to access the <code>Zone_ID</code> as Secret on kubernetes in your namespace.</p>
<p>Please raise a <a href="goo.gl/msfGiS">support ticket</a> with the Cloud Platform.</p>
<p>Provide them with the domain name, the Cloud Platform team will finalize the process <strong>by creating a a matching NS record in the DSD account.</strong></p>
