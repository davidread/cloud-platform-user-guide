<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
      <meta name="robots" content="noindex">

    <title>Other Topics | Cloud Platform User Guide</title>

    <!--[if gt IE 8]><!--><link href="/stylesheets/screen.css" rel="stylesheet" media="screen" /><!--<![endif]-->
    <!--[if lte IE 8]><link href="/stylesheets/screen-old-ie.css" rel="stylesheet" media="screen" /><![endif]-->

    <link rel="canonical" href="https://user-guide.cloud-platform.service.justice.gov.uk/other-topics.html">


    <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
    <script src="/javascripts/application.js"></script>

      <meta property="og:image" content="https://user-guide.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="Cloud Platform User Guide" />
      <meta property="og:title" content="Other Topics" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://user-guide.cloud-platform.service.justice.gov.uk/other-topics.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="user-guide.cloud-platform.service.justice.gov.uk" />
      <meta property="twitter:image" content="https://user-guide.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="Other Topics | Cloud Platform User Guide" />
      <meta property="twitter:url" content="https://user-guide.cloud-platform.service.justice.gov.uk/other-topics.html" />

    
  </head>

  <body>
    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="skip-link">Skip to main content</a>

        <header class="header header--full-width">
  <div class="header__container">
    <div class="header__brand">
        <a href="/">
        <span class="header__title">
          Cloud Platform User Guide
            <span class="phase-banner">INTERNAL</span>
        </span>
        </a>
    </div>

      <div data-module="navigation">
        <button type="button" class="header__navigation-toggle js-nav-toggle" aria-controls="navigation" aria-label="Show or hide top level navigation">Menu</button>

        <nav id="navigation" class="header__navigation js-nav" aria-label="Top Level Navigation" aria-hidden="true">
          <ul>
              <li>
                <a href="/">Documentation</a>
              </li>
              <li>
                <a href="https://github.com/ministryofjustice/cloud-platform-user-guide">GitHub</a>
              </li>
          </ul>
        </nav>
      </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://user-guide.cloud-platform.service.justice.gov.uk"/>
    <label for="search"  class="search__label">Search (via Google)</label>
    <input type="text" id="search" name="q" placeholder="Search" aria-controls="search-results" class="form-control" />
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading" data-module="collapsible-navigation">
                      <ul>
  <li>
    <a href="/#cloud-platform-user-guide">Cloud platform user guide</a>
    <ul>
      <li>
        <a href="/#cloud-platform-user-guide-overview">Overview</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/getting-started.html#getting-started">Getting Started</a>
    <ul>
      <li>
        <a href="/getting-started.html#kubectl-configuration">kubectl configuration</a>
      </li>
      <li>
        <a href="/getting-started.html#creating-a-cloud-platform-environment">Creating a Cloud Platform Environment</a>
      </li>
      <li>
        <a href="/getting-started.html#creating-an-ecr-repository">Creating an ECR repository</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying-applications.html#deploying-applications">Deploying Applications</a>
    <ul>
      <li>
        <a href="/deploying-applications.html#deploying-a-39-hello-world-39-application-to-the-cloud-platform">Deploying a ‘Hello World’ application to the Cloud Platform</a>
      </li>
      <li>
        <a href="/deploying-applications.html#deploying-a-multi-container-application-to-the-cloud-platform">Deploying a multi-container application to the Cloud Platform</a>
      </li>
      <li>
        <a href="/deploying-applications.html#deploying-an-application-to-the-cloud-platform-with-helm">Deploying an application to the Cloud Platform with Helm</a>
      </li>
      <li>
        <a href="/deploying-applications.html#adding-a-secret-to-an-application">Adding a secret to an application</a>
      </li>
      <li>
        <a href="/deploying-applications.html#continuous-deployment-of-an-application-using-circleci-and-helm">Continuous Deployment of an application using CircleCI and Helm</a>
      </li>
      <li>
        <a href="/deploying-applications.html#adding-aws-resources-to-your-environment">Adding AWS resources to your environment</a>
      </li>
      <li>
        <a href="/deploying-applications.html#cleaning-up">Cleaning up</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/monitoring-applications.html#monitoring-applications">Monitoring Applications</a>
    <ul>
      <li>
        <a href="/monitoring-applications.html#using-the-cloud-platform-prometheus-alertmanager-and-grafana">Using the Cloud Platform Prometheus, AlertManager and Grafana</a>
      </li>
      <li>
        <a href="/monitoring-applications.html#creating-your-own-custom-alerts">Creating your own custom alerts</a>
      </li>
      <li>
        <a href="/monitoring-applications.html#getting-application-metrics-into-prometheus">Getting Application Metrics into Prometheus</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/other-topics.html#other-topics">Other Topics</a>
    <ul>
      <li>
        <a href="/other-topics.html#git-crypt">Git-Crypt</a>
      </li>
      <li>
        <a href="/other-topics.html#secrets-overview">Secrets overview</a>
      </li>
      <li>
        <a href="/other-topics.html#kubectl-quick-reference">Kubectl quick reference</a>
      </li>
      <li>
        <a href="/other-topics.html#how-to-access-my-log-data-using-kibana">How to access my log data using Kibana</a>
      </li>
      <li>
        <a href="/other-topics.html#kubernetes-basics-links-to-helpful-beginner-resources">Kubernetes Basics - Links to helpful beginner resources</a>
      </li>
      <li>
        <a href="/other-topics.html#cloud-platform-support">Cloud Platform Support</a>
      </li>
      <li>
        <a href="/other-topics.html#zero-downtime-deployments">Zero Downtime Deployments</a>
      </li>
      <li>
        <a href="/other-topics.html#contributing-to-this-document">Contributing to this document</a>
      </li>
      <li>
        <a href="/other-topics.html#using-an-externally-managed-hostname">Using an externally-managed hostname</a>
      </li>
      <li>
        <a href="/other-topics.html#ip-whitelisting">IP Whitelisting</a>
      </li>
      <li>
        <a href="/other-topics.html#ecr-lifecycle-policy">ECR Lifecycle Policy</a>
      </li>
      <li>
        <a href="/other-topics.html#applying-a-maintenance-page">Applying a Maintenance Page</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/getting-help.html#getting-help">Getting Help</a>
    <ul>
      <li>
        <a href="/getting-help.html#slack-channel">Slack Channel</a>
      </li>
      <li>
        <a href="/getting-help.html#raise-a-support-ticket">Raise a support ticket</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deprecation-warning.html#live-0-cluster-deprecation-notice">LIVE-0 CLUSTER DEPRECATION NOTICE</a>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <h1 id="other-topics">Other Topics</h1>
<p><h2 id="git-crypt">Git-Crypt</h2><p>We use <code>git-crypt</code> to ensure that application secrets are encrypted at rest in git.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ol>
<li>Install <a href="https://gnupg.org/">GPG</a></li>
<li>Install <a href="https://www.agwa.name/projects/git-crypt/">git-crypt</a></li>
<li>Generate a key pair, if you don&rsquo;t have one already. The <a href="https://help.github.com/articles/generating-a-new-gpg-key/">GitHub documentation</a> is a good reference.</li>
<li>Push your public key to a key server: <code>gpg --send-keys PUBKEYID</code></li>
<li>Add the pubkey to your GitHub account, again, following <a href="https://help.github.com/articles/adding-a-new-gpg-key-to-your-github-account/">the documentation</a></li>
</ol>
<h3 id="setup">Setup</h3>
<ul>
<li>If the repository has not been setup before, please follow the <a href="https://github.com/AGWA/git-crypt#using-git-crypt">git-crypt documentation</a> to do so.</li>
</ul>
<p>otherwise,</p></p>

<ul>
<li>Share your <code>PUBKEYID</code> with an existing member of the CloudPlatforms team. They will need to trust your key and add you to the repository (see git-crypt documentation above).</li>
</ul>
<p><h3 id="usage">Usage</h3><p>Once the above has been setup, update your local repository clone and unlock the secrets:</p>
<div class="highlight"><pre class="highlight plaintext"><code>$ git pull
$ git-crypt unlock
</code></pre></div><p>From this point on, <code>git-crypt</code> operates transparently.</p>
<p>You can verify the status of files by using <code>git-crypt status</code>.</p></p>
<p><h2 id="secrets-overview">Secrets overview</h2><p>We identify secrets as one of three kinds:
- user secrets
- system secrets
- application secrets</p>
<h3 id="user-secrets">User Secrets</h3><p>They are essentially any kind of secret that is owned by a specific user (eg. GitHub or AWS credentials). The user is responsible for securely managing these secrets, typically using a password manager and they should not be shared with other individuals or used in applications.</p>
<h3 id="system-secrets">System Secrets</h3><p>They are secrets used in system components, usually configured by someone who manages, configures or supports the system. For example, when setting up a CI pipeline, the credentials it uses to fetch the source code and push the produced artifacts to a repository are considered system secrets.</p>
<p>These should not be tied to an individual user but machine users should be employed. The responsibility of managing these secrets securely lies with the owner of the system.</p>
<h3 id="application-secrets">Application Secrets</h3><p>These are the secrets that the application requires at runtime. Some examples are: API keys for third-party services, keys that applications might use to communicate with each other, database credentials, cookie encryption keys and so on.</p>
<p>This kind of secrets falls under the shared responsibility model:</p></p>

<ul>
<li><p>the owners of the application are responsible for securely managing the secrets at rest (eg. using <a href="/other-topics.html#git-crypt">git-crypt</a> to encrypt them alongside the source code) and also for managing access to the secrets once they&rsquo;ve been added to an environment,</p></li>
<li><p>the Cloud Platform team, on the other hand, is responsible for ensuring the secrets remain secure inside the environment.</p></li>
</ul>
<p><h2 id="kubectl-quick-reference">Kubectl quick reference</h2><p>This document acts as a quick reference to <code>kubectl</code>, listing some of the most common operations.</p>
<p>The examples here only address the most basic approach to these operations. For more options, please refer to the command-line help of <code>kubectl</code> subcommands.</p>
<p>There is also a more detailed <a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/">cheatsheet</a> in the official kubernetes documentation.</p>
<h5 id="inspecting-running-instances-of-the-application">Inspecting running instances of the application</h5><p>To list running <code>Pods</code>:
<code>
$ kubectl -n &lt;namespace&gt; get pods
</code>
To view details for a <code>Pod</code>:
<code>
$ kubectl -n &lt;namespace&gt; describe pod &lt;pod&gt;
</code></p>
<h5 id="viewing-logs">Viewing logs</h5><p>To access the logs of a running container:
<code>
$ kubectl -n &lt;namespace&gt; logs &lt;pod&gt;
</code></p>
<h5 id="viewing-kubernetes-events">Viewing kubernetes events</h5><p>To see kubernetes events, which can help debugging:
<code>
$ kubectl -n &lt;namespace&gt; get events
</code></p>
<h5 id="container-shell">Container shell</h5><p>You can get a shell inside a running container:
<code>
$ kubectl -n &lt;namespace&gt; exec -it &lt;pod&gt; sh
</code>
https://kubernetes.io/docs/tasks/debug-application-cluster/get-shell-running-container/</p>
<h5 id="pod-port-forwarding">Pod port-forwarding</h5><p>To forward port <code>5000</code> on <code>localhost</code> to port <code>5001</code> in the <code>Pod</code>:
<code>
$ kubectl -n &lt;namespace&gt; port-forward &lt;pod&gt; 5000:5001
</code>
https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/</p></p>
<p><h2 id="how-to-access-my-log-data-using-kibana">How to access my log data using Kibana</h2><h3 id="introduction">Introduction</h3><p>This document is intended to assist engineers in accessing application and system logs stored in a centralised Elasticsearch cluster. Using a combination of Fluentd, AWS&rsquo;s Elasticsearch cluster and Kibana the Cloud Platform collects, indexes and presents your application and system log data enabling you to query using Kibana’s standard query language (based on Lucene query syntax). All that&rsquo;s required is that your application writes to stdout.</p>
<h3 id="quick-start">Quick start</h3><p>Live-0 cluster:
<a href="https://kibana.apps.cloud-platform-live-0.k8s.integration.dsd.io/_plugin/kibana">https://kibana.apps.cloud-platform-live-0.k8s.integration.dsd.io/_plugin/kibana</a></p>
<h3 id="how-to-get-my-data-into-elasticsearch">How to get my data into Elasticsearch</h3><p>As long as your application is writing to stdout, it&rsquo;ll be collected by fluentd and passed to the Elasticsearch cluster. Use one of the links above and authenticate with your GitHub username and password.</p>
<h3 id="how-do-i-use-kibana">How do I use Kibana?</h3><p><a href="https://www.elastic.co/guide/en/kibana/6.3/search.html">https://www.elastic.co/guide/en/kibana/6.3/search.html</a></p>
<p><a href="https://www.elastic.co/guide/en/beats/packetbeat/current/kibana-queries-filters.html">https://www.elastic.co/guide/en/beats/packetbeat/current/kibana-queries-filters.html</a></p></p>
<p><h2 id="kubernetes-basics-links-to-helpful-beginner-resources">Kubernetes Basics - Links to helpful beginner resources</h2><p>The purpose of this page is to serve as a small catalogue of links to basic Kubernetes concepts and learning resources.</p>
<h3 id="the-concept">The Concept</h3><p>Kubernetes is very often referred to as <strong>&ldquo;K8s&rdquo;</strong>, purely for the reason, that typing Kubernetes over and over gets quite taxing.</p>
<p>If Kubernetes is a totally new concept to you, then firstly you should probably check out a few of the resources linked below:</p>
<p>Official Website:
<a href="https://kubernetes.io">https://kubernetes.io</a></p>
<p>Offical Docs:
<a href="https://kubernetes.io/docs/concepts">https://kubernetes.io/docs/concepts</a></p>
<p>Quick concept video:
<a href="https://www.youtube.com/watch?v=IMOZCDhH7do">https://www.youtube.com/watch?v=IMOZCDhH7do</a></p>
<p>A part of the concept that is missing from the main offical document is Ingress.
Here&rsquo;s a link that expalins that concept: <a href="https://kubernetes.io/docs/concepts/services-networking/ingress">https://kubernetes.io/docs/concepts/services-networking/ingress</a></p>
<h3 id="experiment-with-local-hosting">Experiment with Local Hosting</h3><p>To keep costs low and for learning the basics, it is possible to host a Kubernetes Cluster locally on your machine. Docker and Minikube both provide tools for this:</p>
<p>Docker: <a href="https://docs.docker.com/docker-for-mac/kubernetes">https://docs.docker.com/docker-for-mac/kubernetes</a></p>
<p>Minikube: <a href="https://docs.docker.com/docker-for-mac/kubernetes">https://kubernetes.io/docs/setup/minikube</a></p>
<p>Kubernetes is normally used with one of the big 3 cloud providers. Amazon Web Services, Google Cloud Engine, and Microsoft Azure.</p>
<h3 id="command-line-kubernetes-interaction">Command Line Kubernetes Interaction</h3><p>Kubernetes has it&rsquo;s own official CLI tool for interacting with a Cluster called <code>kubectl</code>. It is certainly worth learning the basics of <code>kubectl</code>, As the vast majority of time interacting with Kubernetes will be through this tool.</p>
<p>We have our own page on <a href="/other-topics.html#kubectl-quick-reference">Kubectl Basics</a>.</p>
<h3 id="online-courses">Online Courses</h3><p>You will find a multitude of courses online that offer to teach the basics of Kubernetes (and beyond). Some are better than others, some are free, and some require a subscription or one-off payment for access.</p>
<p>Two popular course sites, for example are:</p>
<h4 id="pluralsight">Pluralsight</h4><p><a href="https://www.pluralsight.com/courses/getting-started-kubernetes">https://www.pluralsight.com/courses/getting-started-kubernetes</a></p>
<h4 id="udacity">Udacity</h4><p><a href="https://eu.udacity.com/course/scalable-microservices-with-kubernetes--ud615">https://eu.udacity.com/course/scalable-microservices-with-kubernetes&ndash;ud615</a></p></p>
<p><h2 id="cloud-platform-support">Cloud Platform Support</h2><p><a href="https://docs.google.com/document/d/1M89TXQJIQAqu8yb2wzatlI8PgsXrgOi-GxLtB76XgjU/edit?usp=sharing">https://docs.google.com/document/d/1M89TXQJIQAqu8yb2wzatlI8PgsXrgOi-GxLtB76XgjU/edit?usp=sharing</a></p></p>
<p><h2 id="zero-downtime-deployments">Zero Downtime Deployments</h2><h3 id="zero-downtime-deployments-introduction">Introduction</h3><p>Zero Downtime Deployments are a significant feature of the Cloud Platform, that bring a host of advantages.</p>
<h3 id="rolling-updates">Rolling Updates</h3><p>Rolling updates introduce the ability to update an application without any downtime.</p>
<p>A rolling update works by ensuring there is always one extra Pod than the maximum number stated in the deployment.</p>
<p>The new deployment is applied incrementally, usually one to two Pods at a time until all Pods are running the latest version. How the deployment is rolled out, can be configured by the user. More information about configuring a rolling update can be found <a href="https://kubernetes.io/docs/tasks/run-application/rolling-update-replication-controller/">here</a>.</p>
<p>If an application is exposed publicly, traffic will only be routed to the available Pods. However, this is only the case if the user configured <code>readinessProbes</code> correctly. This is a large topic, so more information can be found <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">here</a>.</p>
<h4 id="the-major-advantage">The Major Advantage</h4><p>Where rolling updates really brings benefit is the enabling of Continuous Integration and Continuous Delivery.</p>
<p>The ability to constantly update your application, with zero downtime, brings a host of benefits.</p>
<h4 id="further-reading">Further Reading</h4><p>If you&rsquo;d like to read more in-depth into rolling updates, then Kubernetes has some great documentation <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/">here</a>.</p>
<h4 id="readiness-liveness-probes-and-ssl-in-rails-applications">Readiness/Liveness probes and SSL in Rails applications</h4><p>For zero downtime deployments, you will need a readiness probe in your application, so that the cluster knows when your container is ready to receive traffic. You will also need a liveness probe, so that the cluster knows if it needs to restart your container after a crash.</p>
<p>SSL will be terminated outside of your pod, so your probes will need to respond to HTTP requests. However, Ruby on Rails applications are sometimes configured to only respond to HTTPS traffic (by adding <code>config.force_ssl = true</code> in the <code>config/environments/production.rb</code> file).</p>
<p>In this case, the application will respond to any HTTP request with a redirect status code, asking the requester to resend the request to the equivalent HTTPS URL. This will cause your probes to fail, because the redirect will not be followed.</p>
<p>To fix this, the probe needs to tell the application that it is an HTTPS request, even though it isn&rsquo;t, so that the application will process the request rather than sending a redirect response. You can do this by adding some HTTP headers to your probe definitions like this:</p>
<div class="highlight"><pre class="highlight plaintext"><code>readinessProbe:
  httpGet:
    path: /ping.json
    port: 3000
    httpHeaders:
      - name: X-Forwarded-Proto
        value: https
      - name: X-Forwarded-Ssl
        value: &quot;on&quot;
</code></pre></div><p>This will send an HTTP request to <code>/ping.json</code>, but the rails application will respond as if it is HTTPS, and your probe should work as expected. This works for both readiness and liveness probes.</p></p>
<p><h2 id="contributing-to-this-document">Contributing to this document</h2><p>This guide is built using <a href="https://pages.github.com/">GitHub Pages</a>.</p>
<p>If you would like to contribute to this guide, please fork <a href="https://github.com/ministryofjustice/cloud-platform-user-docs">the repository</a>, make your changes and then raise a pull request.</p></p>
<p><h2 id="using-an-externally-managed-hostname">Using an externally-managed hostname</h2><h3 id="background">Background</h3><p>Every application running on Cloud Platform is able to use a hostname for their
HTTP endpoints, under a pre-defined DNS zone. For example, on the <code>live-0</code>
cluster, this would be <code>*.apps.cloud-platform-live-0.k8s.integration.dsd.io</code>. As
long as it is defined on the <code>Ingress</code> resource, it works automatically with a
wildcard TLS certificate.</p>
<p>However, most applications will typically need to be served on a <code>gov.uk</code>
hostname. These hostnames (or usually, DNS zones) are managed externally,
relative to the cluster, and there is a number of actions in order to set them
up for usage.</p>
<h3 id="using-an-externally-managed-hostname-setup">Setup</h3><h4 id="you-do-not-have-a-dns-zone-for-the-desired-hostname">You do not have a DNS zone for the desired hostname</h4><p>Please <a href="http://goo.gl/msfGiS">create a support ticket</a> providing as much
information as possible.</p>
<h4 id="you-already-have-a-dns-zone-for-the-desired-hostname">You already have a DNS zone for the desired hostname</h4><h5 id="gt-it-39-s-a-route53-zone">&gt; It&rsquo;s a Route53 zone</h5>
<ol>
<li><p><a href="http://goo.gl/msfGiS">Create a support ticket</a> requesting the <code>provider</code>
name for your <code>Certificate</code> (see the next step).</p></li>
<li><p>Create the <code>Certificate</code>, using the <code>provider</code> name from the previous step.
The <code>secretName</code> attribute defines the <code>Secret</code> where the certificate and key
material will be stored, in your namespace.</p></li>
</ol>
<div class="highlight"><pre class="highlight plaintext"><code>---
apiVersion: certmanager.k8s.io/v1alpha1
kind: Certificate
metadata:
  name: &lt;my-cert&gt;
  namespace: &lt;my-namespace&gt;
spec:
  secretName: &lt;my-cert-secret&gt;
  issuerRef:
    name: letsencrypt-production
    kind: ClusterIssuer
  commonName: &#39;&lt;hostname&gt;&#39;
  acme:
    config:
    - domains:
      - &#39;&lt;hostname&gt;&#39;
      dns01:
        provider: &lt;provider&gt;
</code></pre></div>
<ol>
<li>Make sure the certificate has been issued correctly, by checking its <code>Status</code>:</li>
</ol>
<div class="highlight"><pre class="highlight plaintext"><code>$ kubectl describe certificate &lt;my-cert&gt;
</code></pre></div>
<ol>
<li>You will need to update your <code>Ingress</code> spec to include the new hostname. <strong>Once your host is defined here, the cluster will take control of the DNS record and automatically adjust to point to the cluster.</strong></li>
</ol>
<div class="highlight"><pre class="highlight plaintext"><code>  apiVersion: extensions/v1beta1
  kind: Ingress
  metadata:
    name: &lt;my-ingress&gt;
    namespace: &lt;my-namespace&gt;
  spec:
    tls:
    - hosts:
      - my-app.apps.cloud-platform-live-0.k8s.integration.dsd.io
+   - hosts:
+     - &lt;hostname&gt;
+     secretName: &lt;my-cert-secret&gt;
    rules:
    - host: my-app.apps.cloud-platform-live-0.k8s.integration.dsd.io
      http:
        paths:
        - path: /
          backend:
            serviceName: &lt;my-svc&gt;
            servicePort: 80
+   - host: &lt;hostname&gt;
+     http:
+       paths:
+       - path: /
+         backend:
+           serviceName: &lt;my-svc&gt;
+           servicePort: 80
</code></pre></div><h5 id="gt-it-39-s-a-dns-zone-hosted-with-another-provider">&gt; It&rsquo;s a DNS zone hosted with another provider</h5><p>For the time being, we only support Route53 natively. Depending on the provider
we might be able to accommodate you or we might need to handle this manually, if possible.
Please <a href="http://goo.gl/msfGiS">create a support ticket</a>.</p></p>
<p><h2 id="ip-whitelisting">IP Whitelisting</h2><h3 id="nat-gateways">NAT Gateways</h3><p>Many applications use third-party tools for a variety of reasons, and many of these tools require IP Whitelisting.</p>
<p>The Cloud Platform uses NAT Gateways as its external IP Endpoints.</p>
<p>The IP addresses for the clusters are as follows:</p>
<h4 id="live-0-cluster">Live-0 Cluster</h4><div class="highlight"><pre class="highlight plaintext"><code>52.17.133.167
34.251.93.81
34.247.134.240
</code></pre></div><h4 id="live-1-cluster">Live-1 Cluster</h4><div class="highlight"><pre class="highlight plaintext"><code>35.178.209.113
3.8.51.207
35.177.252.54
</code></pre></div>
<h2 id="ecr-lifecycle-policy">ECR Lifecycle Policy</h2><h3 id="overview">Overview</h3><p>ECR repositories created for use in the Cloud Platform will have a default lifecycle policy applied.</p>
<p>Due to some applications having a constant rate of images being pushed to their ECR repo, we found that the AWS limit of 1000 images was being hit by some teams.</p>
<p>After consulting with application teams, we decided to implement a lifecycle policy of <em>40 images</em> per ECR repo.</p>
<p>If you feel that you have a need to archive more than the last 40 images, please contact the Cloud Platform team, who can adjust or remove the lifecycle policy.</p></p>
<p><h2 id="applying-a-maintenance-page">Applying a Maintenance Page</h2><h3 id="applying-a-maintenance-page-overview">Overview</h3><p>This document will serve as a guide on how to apply a default
maintenance page to your application on the Cloud Platform.</p>
<h3 id="deploying-the-page">Deploying the page</h3><p>A repository has been created to store all the files related to the
maintenance page:</p>
<p><a href="https://github.com/ministryofjustice/cloud-platform-maintenance-page">cloud-platform-maintenance-page</a></p>
<p>The repository contains the manifest files needed to deploy a
standard maintenance page into your namespace. This directory also
contains the maintenance page HTML file, along with a DockerFile
to build an image to serve the maintenance page.</p>
<p>Within the <code>Kubectl_deploy</code> directory, there are 3 simple manifest
files that make up the deployment, <code>deploy.yaml</code>, <code>ingress.yaml</code>
and <code>service.yaml</code>.</p>
<p>To use this example, copy the files into your namespace and make
any changes you require, to tailor the maintenance page to your
service.</p>
<p>Once you have done this, the maintenance page will be deployed
into your namespace, ready for you to use as and when you need
it.</p>
<h4 id="maintenance-deploy-yaml">maintenance-deploy.yaml</h4><p>A notable part of this file is the <code>image</code> line, which points to
the ECR URI.</p>
<p>If you wish to customize the maintenance page, you must edit and
build the image and update the <code>image</code> value.</p>
<h4 id="maintenance-ingress-yaml">maintenance-ingress.yaml</h4><p>In this file, change the example <code>host</code> field to your applications
URL.</p>
<p>Rather than using this file, you may prefer to change your existing
<code>Ingress</code> so that the <code>backend</code> points to your maintenance page,
whenever you need to replace your service with the maintenance page.</p>
<p>This will ensure that you do not incur any downtime (by deleting
the previous ingress and creating a new one).</p></p>


            
          </main>

            <ul class="contribution-banner">
              <li><a href="https://github.com/ministryofjustice/cloud-platform-user-guide/blob/master/source/other-topics.html.md.erb">View source</a></li>
              <li><a href="https://github.com/ministryofjustice/cloud-platform-user-guide/issues/new?labels=bug&amp;title=Re:%20'Other%20Topics'&amp;body=Problem%20with%20'Other%20Topics'%20(https://user-guide.cloud-platform.service.justice.gov.uk/other-topics.html)">Report problem</a></li>
              <li><a href="https://github.com/ministryofjustice/cloud-platform-user-guide">GitHub Repo</a></li>
            </ul>

          <footer class="footer">
  <div class="footer__licence">
    <a class="footer__licence-logo" href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence</a>
    <p class="footer__licence-description">All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence v3.0</a>, except where otherwise stated</p>
  </div>

  <div class="footer__copyright">
    <a class="footer__copyright-logo" href="http://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/copyright-and-re-use/crown-copyright/">© Crown copyright</a>
  </div>
</footer>

        </div>
      </div>
    </div>

    
  </body>
</html>
